<script>
  import jsonLexer from "../lib/json-lexer";


  export let theme = "solarized-dark";
  export let value = "";

  $: tokens = (function () {
    jsonLexer.reset(value);
    return Array.from(jsonLexer);
  }());
</script>

<div class="hyperjump-editor {theme}">
  <pre class="highlighted">
    {#each tokens as token}
      {#if token.type === "grouping"}
        <span class="grouping">{token.value}</span>
      {:else if token.type === "property"}
        "<span class="property">{token.value.substring(1, token.value.length - 1)}</span>"
      {:else if token.type === "string"}
        "<span class="string">{token.value.substring(1, token.value.length - 1)}</span>"
      {:else if token.type === "number"}
        <span class="number">{token.value}</span>
      {:else if token.type === "literal"}
        <span class="atom">{token.value}</span>
      {:else}
        {token.value}
      {/if}
    {/each}
  </pre>
  <textarea class="src" bind:value={value}></textarea>
</div>

<style>
  .hyperjump-editor {
    display: grid;
    min-height: 200px;
    height: 100%;
    overflow: scroll;
    border: thin solid;
    padding: .25em;
    box-sizing: border-box;
  }

  .hyperjump-editor > * {
    font-size: 11pt;
    white-space: pre;
    padding: 0;
    margin: 0;
    border: none;
    resize: none;
    outline: none;
  }

  .highlighted {
    grid-row-start: 1;
    grid-column-start: 1;
  }

  .src {
    grid-row-start: 1;
    grid-column-start: 1;
    background-color: transparent;
    color: transparent;
    caret-color: var(--text-color);
    overflow: hidden;
  }

  .grouping {
    color: var(--grouping-color);
  }

  .property {
    color: var(--property-color);
  }

  .string {
    color: var(--string-color);
  }

  .number {
    color: var(--number-color);
  }

  .atom {
    color: var(--boolean-color);
  }
</style>
